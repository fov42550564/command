var request = require('request')
, _ = require('underscore')
, querystring = require('querystring')
, util = require('util');

function baidu_translate(words, callback)
{
	var list="";
	for (var i=0; i<words.length-1; i++)
		list += words[i]+"\n";
	list += words[i];

	var opts = {q:list};
	opts = _.defaults(opts, {
		client_id:'hYTt6zY0sMwdRmYOWeMC5DL9',
		from:'auto',
		to:'auto',
		q: 'text'
	});

	var url = 'http://openapi.baidu.com/public/2.0/bmt/translate?' + querystring.stringify(opts);
	request.get(url, function(err, response, body){
		if (err) throw err;
		var json = JSON.parse(body);
		if (json.error) {
			throw json.error.message;
		}
		var result="";
		for (var i=0; i<json.trans_result.length-1; i++)
			result += json.trans_result[i].src + " : " + json.trans_result[i].dst+"\n";
		result += json.trans_result[i].src + " : " + json.trans_result[i].dst
		console.log("baidu translate result:");
		console.log(result);
		callback(result);
	});
}

function youdao_translate(words, callback)
{
	var list="";
	for (var i=0; i<words.length-1; i++)
		list += words[i]+"\n";
	list += words[i];

	var opts = {q:list};
	opts = _.defaults(opts, {
		keyfrom:'fov42550564',
		key:'1655272942',
		type:'data',
		doctype:'json',
		version:'1.1',
		q: 'text'
	});
	var url = 'http://fanyi.youdao.com/openapi.do?' + querystring.stringify(opts);
	request.get(url, function(err, response, body){
		if (err) throw err;
		var json = JSON.parse(body);
		if (json.error) {
			throw json.error.message;
		}
		var result="";
		for (var i=0; i<json.translation.length-1; i++)
			result += words[i] + " : " + json.translation[i]+"\n";
		result += words[i] + " : " + json.translation[i]
		console.log("youdao translate result:");
		console.log(result);
		callback(result);
	});
}

var BAIDU_TYPE = 0x01;
var YOUDAO_TYPE = 0x02;
var GOOGLE_TYPE = 0x04;
var YAHOO_TYPE = 0x08;

module.exports = function(type, words, callback) {
	if (type & BAIDU_TYPE)
		baidu_translate(words, callback);
	if (type & YOUDAO_TYPE)
		youdao_translate(words, callback);
};

